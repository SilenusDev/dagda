# DAGDA-LITE - Architecture

**Version**: 2.3 - Faeries  
**Statut**: Production  
**Mise √† jour**: 8 octobre 2025

---

## ‚ö†Ô∏è R√àGLE : 1 service = 1 emplacement

### ‚ùå INTERDICTIONS STRICTES

**NE JAMAIS cr√©er ces dossiers** :
- `/cauldron/cromlech/fastapi/` ‚ùå (FastAPI est dans `/cauldron/muirdris/fastapi/`)
- `/cauldron/cromlech/sidhe/` ‚ùå (Sidhe pod est dans `/cauldron/ogmios/sidhe/`)

---

## ‚úÖ ARCHITECTURE OFFICIELLE

```
dagda-lite/
‚îú‚îÄ‚îÄ .env                          # Config active (auto-g√©n√©r√©)
‚îú‚îÄ‚îÄ .env.dev                      # Config d√©veloppement (localhost)
‚îú‚îÄ‚îÄ .env.prod                     # Config production (IP serveur)
‚îú‚îÄ‚îÄ .env.example                  # Template configuration
‚îú‚îÄ‚îÄ .windsurfrules                # R√®gles s√©curit√© et diagnostic
‚îÇ
‚îú‚îÄ‚îÄ dagda/                        # MOTEUR D'ORCHESTRATION
‚îÇ   ‚îú‚îÄ‚îÄ eveil/                    # Scripts d'orchestration
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ taranis.sh            # Orchestrateur principal (start/stop/status)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ setup-sidhe.sh        # Installation automatis√©e Sidhe
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ launch-sidhe.sh       # Lancement manuel Sidhe (legacy)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ switch-env.sh         # Basculement dev/prod
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ stop_all.sh           # Arr√™t d'urgence
‚îÇ   ‚îú‚îÄ‚îÄ awen-core/                # Moteur principal
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ teine_engine.sh       # Moteur g√©n√©rique pods (start/stop/clean)
‚îÇ   ‚îú‚îÄ‚îÄ awens-utils/              # Utilitaires bash
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ ollamh.sh             # Fonctions communes + d√©tection architecture
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ imbas-logging.sh      # Syst√®me de logs standardis√©
‚îÇ   ‚îî‚îÄ‚îÄ bairille-dighe/           # Templates configuration
‚îÇ       ‚îî‚îÄ‚îÄ coire-template.yml    # Template pod g√©n√©rique
‚îÇ
‚îú‚îÄ‚îÄ cauldron/                     # SERVICES CONTENEURIS√âS
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ cromlech/                 # BASES DE DONN√âES UNIQUEMENT
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ mariadb/              # ‚úÖ MariaDB (port 8901)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage.sh         # Script gestion
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/             # Donn√©es MariaDB
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ config/           # Configuration MariaDB
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ init/             # Scripts d'initialisation SQL
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yarn/                 # ‚úÖ Gestionnaire Node.js (port 8907)
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ data/             # Cache Yarn
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ config/           # Configuration Yarn
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ muirdris/                 # SERVICES PYTHON
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ fastapi/              # ‚úÖ API principale (port 8902) - SEUL EMPLACEMENT
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage.sh         # Script gestion
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ Dockerfile        # Image personnalis√©e
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ app/              # Code application
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ main.py       # Point d'entr√©e FastAPI
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api/          # Endpoints API
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llm.py    # Routes LLM
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ system.py # Routes syst√®me
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ web/          # Interface web
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ static/   # Assets statiques
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ templates/ # Templates HTML
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.py     # Mod√®les Pydantic
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt  # D√©pendances Python
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/             # Donn√©es application
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/           # Configuration FastAPI
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ faeries/              # ‚úÖ Services LLM (IA)
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ llama/            # LLM Llama (port 8905)
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pod.yml       # Config Podman
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ manage.sh     # Script gestion
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ data/         # Mod√®les Llama
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config/       # Configuration Llama
‚îÇ   ‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ qwen/             # LLM Qwen2.5 (port 8906)
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pod.yml       # Config Podman
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ manage.sh     # Script gestion
‚îÇ   ‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ data/         # Mod√®les Qwen
‚îÇ   ‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ config/       # Configuration Qwen
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ specs.md              # Sp√©cifications Muirdris
‚îÇ   ‚îÇ
‚îÇ   ‚îú‚îÄ‚îÄ ogmios/                   # INTERFACES UTILISATEUR
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ sidhe/                # ‚úÖ Interface SolidJS (port 8900) - SEUL POD
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ manage.sh         # Script gestion
‚îÇ   ‚îÇ   ‚îÇ
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ dolmen/               # Monitoring
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ pod.yml           # Config Podman (√† impl√©menter)
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ manage.sh         # Script gestion (√† impl√©menter)
‚îÇ   ‚îÇ
‚îÇ   ‚îî‚îÄ‚îÄ fianna/                   # APPLICATIONS TIERCES
‚îÇ       ‚îú‚îÄ‚îÄ adminer/              # Interface DB (port 8903)
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ       ‚îÇ   ‚îú‚îÄ‚îÄ manage.sh         # Script gestion
‚îÇ       ‚îÇ   ‚îî‚îÄ‚îÄ data/             # Donn√©es Adminer
‚îÇ       ‚îÇ
‚îÇ       ‚îî‚îÄ‚îÄ n8n/                  # Workflows (port 8904)
‚îÇ           ‚îú‚îÄ‚îÄ pod.yml           # Config Podman
‚îÇ           ‚îú‚îÄ‚îÄ manage.sh         # Script gestion
‚îÇ           ‚îî‚îÄ‚îÄ data/             # Donn√©es N8N
‚îÇ
‚îú‚îÄ‚îÄ sidhe/                        # CODE SOURCE SolidJS (pas de pod ici)
‚îÇ   ‚îú‚îÄ‚îÄ src/                      # Code source
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ assets/               # Assets optimis√©s
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img/              # Images optimis√©es par Vite
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ components/           # Composants r√©utilisables
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ pages/                # Pages application
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ Home.tsx          # Page d'accueil
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/             # Clients API (vers FastAPI)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ App.tsx               # Application principale
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.tsx             # Point d'entr√©e
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ index.css             # CSS vanilla (280 lignes)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.ts             # Configuration
‚îÇ   ‚îú‚îÄ‚îÄ public/                   # Assets statiques
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ img/                  # Images (logos, favicons)
‚îÇ   ‚îú‚îÄ‚îÄ dist/                     # Build production (g√©n√©r√©)
‚îÇ   ‚îú‚îÄ‚îÄ node_modules/             # D√©pendances (g√©n√©r√©)
‚îÇ   ‚îú‚îÄ‚îÄ package.json              # D√©pendances Node.js
‚îÇ   ‚îú‚îÄ‚îÄ vite.config.ts            # Config Vite (polling)
‚îÇ   ‚îú‚îÄ‚îÄ tsconfig.json             # Config TypeScript
‚îÇ   ‚îî‚îÄ‚îÄ README.md                 # Documentation Sidhe
‚îÇ
‚îú‚îÄ‚îÄ dolmen/                       # MONITORING (legacy - √† migrer dans ogmios)
‚îÇ   ‚îî‚îÄ‚îÄ service_status.json       # √âtat temps r√©el des services
‚îÇ
‚îî‚îÄ‚îÄ docs/                         # DOCUMENTATION
    ‚îú‚îÄ‚îÄ ARCHITECTURE.md           # Ce fichier - Structure + R√®gles
    ‚îú‚îÄ‚îÄ PROJECT.md                # TODO / DOING / DONE
    ‚îú‚îÄ‚îÄ USAGE.md                  # Commandes essentielles
    ‚îú‚îÄ‚îÄ SIDHE.md                  # Interface compl√®te
    ‚îî‚îÄ‚îÄ TROUBLESHOOTING.md        # D√©pannage
```

---

## üìç EMPLACEMENTS UNIQUES

### FastAPI
- **Pod** : `/cauldron/muirdris/fastapi/pod.yml`
- **Code** : `/cauldron/muirdris/fastapi/app/`
- **Jamais ailleurs** ‚ùå

### Sidhe
- **Pod** : `/cauldron/ogmios/sidhe/pod.yml`
- **Code source** : `/sidhe/src/`
- **Jamais dans cromlech** ‚ùå

### MariaDB
- **Pod** : `/cauldron/cromlech/mariadb/pod.yml`
- **Seul dans cromlech** ‚úÖ

### Yarn
- **Pod** : `/cauldron/cromlech/yarn/pod.yml`
- **Seul dans cromlech** ‚úÖ

---

## üéØ R√àGLES PAR CAT√âGORIE

### `cromlech/` - Bases de donn√©es
**Contient UNIQUEMENT** :
- ‚úÖ `mariadb/`
- ‚úÖ `yarn/`
- ‚ùå Rien d'autre

### `muirdris/` - Services Python
**Contient UNIQUEMENT** :
- ‚úÖ `fastapi/` (API principale)
- ‚úÖ `faeries/` (LLM : llama, qwen)
- ‚ùå Pas d'interfaces

### `ogmios/` - Interfaces utilisateur
**Contient UNIQUEMENT** :
- ‚úÖ `sidhe/` (pod SolidJS)
- ‚úÖ `dolmen/` (monitoring)
- ‚ùå Pas de services backend

### `fianna/` - Applications tierces
**Contient UNIQUEMENT** :
- ‚úÖ `adminer/`
- ‚úÖ `n8n/`
- ‚ùå Pas de services custom

---

## üîç V√âRIFICATION RAPIDE

### Commandes de v√©rification
```bash
# V√©rifier qu'il n'y a PAS de doublons
ls -la cauldron/cromlech/        # Doit contenir UNIQUEMENT mariadb/ et yarn/
ls -la cauldron/muirdris/fastapi/ # Doit exister (SEUL FastAPI)
ls -la cauldron/ogmios/sidhe/    # Doit exister (SEUL pod Sidhe)

# Ces dossiers NE DOIVENT PAS exister
ls -la cauldron/cromlech/fastapi/ 2>/dev/null && echo "‚ùå DOUBLON D√âTECT√â"
ls -la cauldron/cromlech/sidhe/ 2>/dev/null && echo "‚ùå DOUBLON D√âTECT√â"
```

---

## üö® SI DOUBLONS D√âTECT√âS

### Nettoyage imm√©diat
```bash
# Supprimer les doublons
rm -rf cauldron/cromlech/fastapi
rm -rf cauldron/cromlech/sidhe

# V√©rifier
ls -la cauldron/cromlech/  # Doit montrer UNIQUEMENT mariadb/ et yarn/
```

---

## üìù HISTORIQUE DES CORRECTIONS

- **8 octobre 2025** : Suppression des doublons `cromlech/fastapi/` et `cromlech/sidhe/`
- **Architecture clarifi√©e** : Chaque service a UN SEUL emplacement
- **Documentation mise √† jour** : `docs/architecture.md` corrig√©

---

## ‚úÖ CHECKLIST AVANT TOUTE MODIFICATION

Avant de cr√©er un nouveau dossier dans `cauldron/`, v√©rifier :

1. ‚òê Le service existe-t-il d√©j√† ailleurs ?
2. ‚òê Est-ce que je respecte la cat√©gorisation (cromlech/muirdris/ogmios/fianna) ?
3. ‚òê Ai-je v√©rifi√© qu'il n'y a pas de doublon ?
4. ‚òê Ai-je mis √† jour `docs/architecture.md` ?

---

## üéØ R√âSUM√â ULTRA-SIMPLE

**1 service = 1 emplacement**

- FastAPI ‚Üí `/cauldron/muirdris/fastapi/`
- Sidhe pod ‚Üí `/cauldron/ogmios/sidhe/`
- Sidhe code ‚Üí `/sidhe/`
- MariaDB ‚Üí `/cauldron/cromlech/mariadb/`
- Yarn ‚Üí `/cauldron/cromlech/yarn/`

**FIN. Aucune exception.**
